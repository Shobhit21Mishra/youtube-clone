import{r as x,j as e,F as S,t as _,u as v,a as g,v as w,y as u,w as D,x as L,z as V,L as E,m as T,q as U,f as P,A,i as y,b as F,B,C as $,D as z,E as H}from"./index-DtHP9t1G.js";import{h as k,f as R}from"./formatDuration-CfKS_jPf.js";import{V as q}from"./index-CtDILEI9.js";function I({video:s}){var r,o;const[t,a]=x.useState(!0),[c,d]=x.useState(!1),n=()=>{a(!1)},l=()=>{a(!1),d(!0),q.error("Failed to load video.")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"aspect-video mb-4 relative w-full",children:[t&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 z-10 rounded-xl",children:e.jsx("div",{className:"text-white font-semibold animate-pulse",children:"Loading video..."})}),e.jsx("video",{src:s.videoUrl,controls:!0,className:`w-full h-full rounded-xl shadow-lg ${t?"opacity-0":"opacity-100"} transition-opacity duration-300`,onLoadedData:n,onError:l})]}),c?e.jsx("div",{className:"text-red-600 text-sm font-medium mb-2",children:"Unable to display video."}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-xl font-bold mb-2",children:s.title}),e.jsxs("div",{className:"flex flex-wrap justify-between items-center text-sm text-gray-600 mb-4",children:[e.jsx("span",{children:k(s.createdAt).fromNow()}),e.jsxs("span",{className:"text-xs sm:text-sm",children:[s.views||0," views • ",((r=s.likes)==null?void 0:r.length)||0," Likes • ",((o=s.dislikes)==null?void 0:o.length)||0," Dislikes"]})]})]})]})}function M({video:s,currentChannel:t,isSubscribed:a,onSubscribeToggle:c}){var d,n,l,r;return e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center md:items-center gap-6 mb-6 border-b border-gray-200 pb-4",children:[e.jsxs("div",{className:"flex items-center gap-4 w-full md:w-auto",children:[e.jsx("img",{src:((d=s.channel)==null?void 0:d.channelBanner)||"/default-avatar.png",alt:"Channel",className:"w-16 h-16 rounded-full object-cover shadow-md flex-shrink-0"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:(n=s.channel)==null?void 0:n.channelName}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:(l=s.uploader)==null?void 0:l.username}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[((r=t==null?void 0:t.subscribers)==null?void 0:r.toLocaleString())||0," subscribers"]})]})]}),e.jsx("div",{className:"w-full md:w-auto flex justify-center md:justify-end",children:e.jsx("button",{onClick:c,className:`px-6 py-2 rounded-full font-semibold text-sm shadow-md transition whitespace-nowrap
            ${a?"bg-gray-200 text-gray-800 hover:bg-gray-300":"bg-red-600 text-white hover:bg-red-700"}
          `,children:a?"Subscribed":"Subscribe"})})]})}function W({video:s,onLike:t,onDislike:a,user:c}){var l,r;const d=((l=s.likes)==null?void 0:l.length)||0,n=((r=s.dislikes)==null?void 0:r.length)||0;return e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsxs("button",{onClick:t,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-800 rounded-full shadow-sm hover:bg-gray-200 transition duration-200",children:[e.jsx(S,{className:"text-blue-600"}),e.jsx("span",{className:"font-medium text-sm",children:"Like"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["(",d,")"]})]}),e.jsxs("button",{onClick:a,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-800 rounded-full shadow-sm hover:bg-gray-200 transition duration-200",children:[e.jsx(_,{className:"text-red-600"}),e.jsx("span",{className:"font-medium text-sm",children:"Dislike"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["(",n,")"]})]})]})}function G({description:s}){const[t,a]=x.useState(!1);return e.jsxs("div",{className:"mb-6 bg-gray-100 p-4 rounded-lg shadow",children:[e.jsx("button",{className:"font-medium text-black hover:underline",onClick:()=>a(c=>!c),children:t?"Hide Description":"Show Description"}),t&&e.jsx("p",{className:"text-gray-800 whitespace-pre-wrap mt-2",children:s})]})}const J=({videoId:s})=>{const t=v(),{user:a}=g(i=>i.auth),{items:c,loading:d}=g(i=>i.comments),[n,l]=x.useState(""),[r,o]=x.useState(null),[h,f]=x.useState("");x.useEffect(()=>{s&&t(w(s))},[s,t]);const p=async()=>{if(!a){u.info("Please login to comment.");return}n.trim()&&(await t(D({videoId:s,text:n})),await t(w(s)),l(""))},b=i=>{h.trim()&&(t(V({commentId:i,text:h,videoId:s})),o(null),f(""))},m=i=>{t(L({commentId:i,videoId:s}))};return e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Comments"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("input",{className:"border border-gray-300 px-4 py-2 rounded-lg w-full",value:n,onChange:i=>l(i.target.value),placeholder:"Add a comment..."}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",onClick:p,children:"Post"})]}),d&&e.jsx("p",{className:"text-gray-500",children:"Loading comments..."}),e.jsx("div",{className:"space-y-4",children:c.map(i=>{var j,N;return e.jsxs("div",{className:"bg-white shadow p-4 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-medium text-gray-800",children:((j=i.author)==null?void 0:j.username)||"Unknown User"}),a&&((N=i.author)==null?void 0:N._id)===a._id&&e.jsxs("div",{className:"flex gap-2 text-sm",children:[e.jsx("button",{onClick:()=>{o(i._id),f(i.text)},className:"text-blue-500 hover:underline",children:"Edit"}),e.jsx("button",{onClick:()=>m(i._id),className:"text-red-500 hover:underline",children:"Delete"})]})]}),r===i._id?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{className:"border border-gray-300 px-3 py-2 rounded w-full",value:h,onChange:C=>f(C.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700",onClick:()=>b(i._id),children:"Save"}),e.jsx("button",{className:"bg-gray-300 px-3 py-1 rounded hover:bg-gray-400",onClick:()=>o(null),children:"Cancel"})]})]}):e.jsx("p",{className:"text-gray-700",children:i.text})]},i._id)})})]})};function K({videoId:s}){const[t,a]=x.useState(!0);return e.jsxs("div",{className:"mb-6 bg-gray-100 p-4 rounded-lg shadow",children:[e.jsx("button",{className:"font-medium text-blue-600 hover:underline",onClick:()=>a(c=>!c),children:t?"Hide Comments":"Show Comments"}),t&&e.jsx("div",{className:"mt-4",children:e.jsx(J,{videoId:s})})]})}const O=({videos:s=[],currentVideoId:t,isLoading:a,error:c})=>{if(a)return e.jsx("div",{className:"flex justify-center items-center h-40",children:e.jsx("span",{className:"loader animate-spin w-6 h-6 border-4 border-blue-500 border-t-transparent rounded-full"})});if(c)return e.jsx("div",{className:"bg-red-100 text-red-700 px-4 py-3 rounded-md text-sm",children:c||"Something went wrong while loading suggested videos."});if(!Array.isArray(s))return null;const d=s.filter(n=>n._id!==t);return e.jsxs("div",{className:"space-y-4 w-full",children:[e.jsx("h3",{className:"text-lg font-bold mb-2 text-neutral-900",children:"Suggested Videos"}),d.map(n=>{var l,r,o;return e.jsxs(E,{to:`/video/${n._id}`,className:"flex sm:flex-row flex-col gap-3 hover:bg-neutral-100 p-2 rounded-lg transition w-full",children:[e.jsxs("div",{className:"relative w-full sm:w-36 h-24 flex-shrink-0 rounded overflow-hidden",children:[e.jsx("img",{src:n.thumbnailUrl||"/default-thumbnail.jpg",alt:n.title||"Video thumbnail",className:"w-full h-full object-cover rounded"}),n.duration&&e.jsx("span",{className:"absolute bottom-1 right-1 bg-black bg-opacity-80 text-white text-xs px-1.5 py-0.5 rounded",children:R(n.duration)})]}),e.jsxs("div",{className:"flex flex-col justify-between overflow-hidden w-full",children:[e.jsx("p",{className:"text-sm font-semibold text-neutral-900 leading-snug line-clamp-2",children:n.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx("img",{src:((l=n.channel)==null?void 0:l.channelBanner)||"/default-avatar.png",alt:((r=n.channel)==null?void 0:r.channelName)||"Channel",className:"w-6 h-6 rounded-full object-cover"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-medium text-neutral-800 truncate max-w-[150px]",children:((o=n.channel)==null?void 0:o.channelName)||"Unknown Channel"}),e.jsx("span",{className:"text-xs text-neutral-600",children:k(n.createdAt).fromNow()})]})]})]})]},n._id)})]})},Z=()=>{var b;const{videoId:s}=T(),t=v(),{selectedVideo:a,videos:c,loading:d,error:n}=g(m=>m.videos),{user:l}=g(m=>m.auth),{currentChannel:r}=g(m=>m.channel),o=x.useMemo(()=>!l||!(r!=null&&r.subscribersList)?!1:r.subscribersList.includes(l._id),[l==null?void 0:l._id,r==null?void 0:r.subscribersList]);x.useEffect(()=>{s&&(t(U(s)),t(P()),t(A(s)))},[t,s]),x.useEffect(()=>{var m;(m=a==null?void 0:a.channel)!=null&&m._id&&t(y(a.channel._id))},[t,(b=a==null?void 0:a.channel)==null?void 0:b._id]);const h=()=>{if(!l)return u.info("Please log in to like the video.");t(H(s))},f=()=>{if(!l)return u.info("Please log in to dislike the video.");t(z(s))},p=async()=>{if(!l)return u.info("Please log in to subscribe.");try{o?(await t(B(r._id)).unwrap(),u.success("Unsubscribed from the channel.")):(await t($(r._id)).unwrap(),u.success("Subscribed to the channel.")),t(y(a.channel._id))}catch{u.error("Something went wrong. Please try again.")}};return d?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(F,{})}):n?e.jsxs("div",{className:"text-red-600 text-center p-6 bg-red-50 border border-red-200 rounded max-w-xl mx-auto mt-10",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Error loading video"}),e.jsx("p",{children:n})]}):a?e.jsxs("div",{className:"flex flex-col md:flex-row gap-8 p-4 max-w-7xl mx-auto",children:[e.jsxs("section",{className:"md:w-2/3 w-full flex flex-col space-y-6",children:[e.jsx(I,{video:a}),e.jsx(M,{video:a,currentChannel:r,isSubscribed:o,onSubscribeToggle:p,user:l}),e.jsx(W,{video:a,onLike:h,onDislike:f,user:l}),e.jsx(G,{description:a.description}),e.jsx(K,{videoId:a._id})]}),e.jsx("aside",{className:"md:w-1/3 w-full max-h-[calc(100vh-100px)] overflow-y-auto sticky top-24",children:e.jsx(O,{videos:c.filter(m=>m._id!==a._id),currentVideoId:a._id})})]}):e.jsxs("div",{className:"text-center text-gray-600 p-6 mt-10",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Video Not Found"}),e.jsx("p",{children:"This video may have been removed or the URL is incorrect."})]})};export{Z as default};
